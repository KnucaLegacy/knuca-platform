language: java
jdk:
    - oraclejdk8
sudo: required
services:
      - docker

stages:
  - "Build"
  - "Package"
  - "Deploy"
  
before_script: cd knuca-schedule

jobs: 
  include: 
    - 
      stage: Build
      script: 
        - ./gradlew build
        - bash <(curl -s https://codecov.io/bash)
        - ./gradlew dockerfile
    - 
      stage: Package
      before_script: "docker login -u \"$DOCKER_HUB_USERNAME\" -p \"$DOCKER_HUB_PASSWORD\""
      script: 
        - "docker build -t knuca-image docker/.; docker tag knuca-image $DOCKER_HUB_USERNAME/knuca-platform:$TRAVIS_BUILD_NUMBER"
        - "docker tag knuca-image $DOCKER_HUB_USERNAME/knuca-platform:latest"
        - "docker push $DOCKER_HUB_USERNAME/knuca-platform:$TRAVIS_BUILD_NUMBER"
        - "docker push $DOCKER_HUB_USERNAME/knuca-platform:latest; ./gradlew jacocoTestReport"
    - 
      stage: Deploy
      script: ls
      
